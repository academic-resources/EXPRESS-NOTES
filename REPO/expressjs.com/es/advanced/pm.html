<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Gestores de procesos para las aplicaciones Express</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Gestores de procesos para las aplicaciones Express</h1>
</header>
<h1 id="gestores-de-procesos-para-las-aplicaciones-express">Gestores de procesos para las aplicaciones Express</h1>
<p>Cuando ejecuta aplicaciones Express en producción, es muy útil utilizar un <em>gestor de procesos</em> para realizar las siguientes tareas:</p>
<ul>
<li>Reiniciar la aplicación automáticamente si se bloquea.</li>
<li>Obtener información útil sobre el rendimiento en tiempo de ejecución y el consumo de recursos.</li>
<li>Modificar dinámicamente los valores para mejorar el rendimiento.</li>
<li>Controlar la agrupación en clúster.</li>
</ul>
<p>Un gestor de procesos es una especie de servidor de aplicaciones: un “contenedor” de aplicaciones que facilita el despliegue, proporciona una alta disponibilidad y permite gestionar la aplicación en el tiempo de ejecución.</p>
<p>Los gestores de procesos más conocidos para Express y otras aplicaciones Node.js son los siguientes:</p>
<ul>
<li><a href="#sl">StrongLoop Process Manager</a></li>
<li><a href="#pm2">PM2</a></li>
<li><a href="#forever">Forever</a></li>
</ul>
<p>El uso de estas tres herramientas puede ser muy útil, aunque StrongLoop Process Manager es la única que proporciona una solución completa de despliegue y tiempo de ejecución que gestiona el ciclo de vida completo de la aplicación Node.js, con herramientas para cada paso antes y después de la producción, en una interfaz unificada.</p>
<p>A continuación, se describe brevemente cada una de estas herramientas. Para ver una comparación detallada, consulte <a href="http://strong-pm.io/compare/">http://strong-pm.io/compare/</a>.</p>
<h2 id="strongloop-process-manager"><a id="sl">StrongLoop Process Manager</a></h2>
<p>StrongLoop Process Manager (StrongLoop PM) es un gestor de procesos de producción para las aplicaciones Node.js. StrongLoop PM tiene incorporado un despliegue de equilibrio de carga, supervisión y varios hosts, así como una consola gráfica. Puede utilizar StrongLoop PM para las siguientes tareas:</p>
<ul>
<li>Crear, empaquetar y desplegar la aplicación Node.js en un sistema local o remoto.</li>
<li>Ver perfiles de CPU e instantáneas de almacenamiento dinámico para optimizar el rendimiento y diagnosticar fugas de memoria.</li>
<li>Mantener activos siempre los clústeres y los procesos.</li>
<li>Ver medidas de rendimiento sobre la aplicación.</li>
<li>Gestionar fácilmente los despliegues de varios hosts con la integración de Nginx.</li>
<li>Unificar varios StrongLoop PM en un tiempo de ejecución de microservicios distribuidos que se gestiona desde Arc.</li>
</ul>
<p>Puede trabajar con StrongLoop PM utilizando una potente herramienta de interfaz de línea de mandatos denominada <code>slc</code> o una herramienta gráfica denominada Arc. Arc es de código abierto, con soporte profesional proporcionado por StrongLoop.</p>
<p>Para obtener más información, consulte <a href="http://strong-pm.io/">http://strong-pm.io/</a>.</p>
<p>Documentación completa:</p>
<ul>
<li><a href="http://docs.strongloop.com/display/SLC">Operating Node apps (documentación de StrongLoop)</a></li>
<li><a href="http://docs.strongloop.com/display/SLC/Using+Process+Manager">Using StrongLoop Process Manager</a>.</li>
</ul>
<h3 id="instalación">Instalación</h3>
<pre>
<code class="language-sh" translate="no">
$ [sudo] npm install -g strongloop
</code>
</pre>
<h3 id="uso-básico">Uso básico</h3>
<pre>
<code class="language-sh" translate="no">
$ cd my-app
$ slc start
</code>
</pre>
<p>Vea el estado del gestor de procesos y todas las aplicaciones desplegadas:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl
Service ID: 1
Service Name: my-app
Environment variables:
  No environment variables defined
Instances:
    Version  Agent version  Cluster size
     4.1.13      1.5.14           4
Processes:
        ID      PID   WID  Listening Ports  Tracking objects?  CPU profiling?
    1.1.57692  57692   0
    1.1.57693  57693   1     0.0.0.0:3001
    1.1.57694  57694   2     0.0.0.0:3001
    1.1.57695  57695   3     0.0.0.0:3001
    1.1.57696  57696   4     0.0.0.0:3001
</code>
</pre>
<p>Liste todas las aplicaciones (servicios) que se están gestionando:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl ls
Id          Name         Scale
 1          my-app       1
</code>
</pre>
<p>Detenga una aplicación:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl stop my-app
</code>
</pre>
<p>Reinicie una aplicación:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl restart my-app
</code>
</pre>
<p>También puede realizar un “reinicio suave”, que da a los procesos de trabajador un periodo de gracia para cerrar las conexiones existentes y, a continuación, reinicia la aplicación actual:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl soft-restart my-app
</code>
</pre>
<p>Para eliminar una aplicación de la gestión:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl remove my-app
</code>
</pre>
<h2 id="pm2"><a id="pm2">PM2</a></h2>
<p>PM2 es un gestor de procesos de producción para las aplicaciones Node.js que tiene un equilibrador de carga incorporado. PM2 permite mantener siempre activas las aplicaciones y volver a cargarlas sin ningún tiempo de inactividad, a la vez que facilita tareas comunes de administrador del sistema. PM2 también permite gestionar el registro de aplicaciones, la supervisión y la agrupación en clúster.</p>
<p>Para obtener más información, consulte <a href="https://github.com/Unitech/pm2">https://github.com/Unitech/pm2</a>.</p>
<h3 id="instalación-1">Instalación</h3>
<pre>
<code class="language-sh" translate="no">
$ [sudo] npm install pm2 -g
</code>
</pre>
<h3 id="uso-básico-1">Uso básico</h3>
<p>Cuando inicia una aplicación utilizando el mandato <code>pm2</code>, debe especificar la vía de acceso de la aplicación. No obstante, cuando detiene, reinicia o suprime una aplicación, sólo puede especificar el nombre o el ID de la aplicación.</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 start npm --name my-app -- start
[PM2] restartProcessId process id 0
┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐
│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │
├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤
│ my-app   │ 0  │ fork │ 64029 │ online │ 1       │ 0s     │ 17.816 MB   │ disabled │
└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘
 Use the `pm2 show <id|name>` command to get more details about an app.
</code>
</pre>
<p>Cuando inicia una aplicación utilizando el mandato <code>pm2</code>, la aplicación se envía inmediatamente al segundo plano. Puede controlar la aplicación en segundo plano desde la línea de mandatos utilizando varios mandatos <code>pm2</code>.</p>
<p>Cuando se inicia una aplicación utilizando el mandato <code>pm2</code>, se registra en la lista de procesos de PM2 con un ID. Por lo tanto, puede gestionar las aplicaciones con el mismo nombre de distintos directorios en el sistema utilizando su ID.</p>
<p>Tenga en cuenta que si se ejecuta más de una aplicación con el mismo nombre, los mandatos <code>pm2</code> se aplican en todas ellas. Por lo tanto, utilice ID en lugar de nombres para gestionar aplicaciones individuales.</p>
<p>Liste todos los procesos en ejecución:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 list
</code>
</pre>
<p>Detenga una aplicación:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 stop 0
</code>
</pre>
<p>Reinicie una aplicación:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 restart 0
</code>
</pre>
<p>Para ver información detallada sobre una aplicación:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 show 0
</code>
</pre>
<p>Para eliminar una aplicación del registro de PM2:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 delete 0
</code>
</pre>
<h2 id="forever"><a id="forever">Forever</a></h2>
<p>Forever es una herramienta de interfaz de línea de mandatos simple que permite garantizar la ejecución continua (forever/siempre) de un determinado script. La sencilla interfaz de Forever hace que sea ideal para ejecutar los despliegues más pequeños de scripts y aplicaciones Node.js.</p>
<p>Para obtener más información, consulte <a href="https://github.com/foreverjs/forever">https://github.com/foreverjs/forever</a>.</p>
<h3 id="instalación-2">Instalación</h3>
<pre>
<code class="language-sh" translate="no">
$ [sudo] npm install forever -g
</code>
</pre>
<h3 id="uso-básico-2">Uso básico</h3>
<p>Para iniciar un script, utilice el mandato <code>forever start</code> y especifique la vía de acceso del script:</p>
<pre>
<code class="language-sh" translate="no">
$ forever start script.js
</code>
</pre>
<p>Este mandato ejecutará el script en modalidad daemon (en segundo plano).</p>
<p>Para ejecutar el script para que se adjunte al terminal, omita <code>start</code>:</p>
<pre>
<code class="language-sh" translate="no">
$ forever script.js
</code>
</pre>
<p>Se recomienda registrar la salida de la herramienta Forever y el script utilizando las opciones de registro <code>-l</code>, <code>-o</code> y <code>-e</code>, como se muestra en este ejemplo:</p>
<pre>
<code class="language-sh" translate="no">
$ forever start -l forever.log -o out.log -e err.log script.js
</code>
</pre>
<p>Para ver la lista de scripts que ha iniciado Forever:</p>
<pre>
<code class="language-sh" translate="no">
$ forever list
</code>
</pre>
<p>Para detener un script iniciado por Forever, utilice el mandato <code>forever stop</code> y especifique el índice de procesos (como se lista con el mandato <code>forever list</code>).</p>
<pre>
<code class="language-sh" translate="no">
$ forever stop 1
</code>
</pre>
<p>De manera alternativa, puede especificar la vía de acceso del archivo:</p>
<pre>
<code class="language-sh" translate="no">
$ forever stop script.js
</code>
</pre>
<p>Para detener todos los scripts que ha iniciado Forever:</p>
<pre>
<code class="language-sh" translate="no">
$ forever stopall
</code>
</pre>
<p>Forever tiene más opciones y también proporciona una API mediante programación.</p>
</body>
</html>
